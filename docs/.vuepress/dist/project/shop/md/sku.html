<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>SPU、SKU | 前端面试知识总结</title>
    <meta name="description" content="自家使用,暂不外传">
    <meta name="generator" content="VuePress 1.3.1">
    <link rel="icon" href="/favicon.ico">
    
    <link rel="preload" href="/assets/css/0.styles.6a4803ab.css" as="style"><link rel="preload" href="/assets/js/app.81dd3622.js" as="script"><link rel="preload" href="/assets/js/2.d1b1e148.js" as="script"><link rel="preload" href="/assets/js/39.fcdeadea.js" as="script"><link rel="preload" href="/assets/js/4.a3faee54.js" as="script"><link rel="prefetch" href="/assets/js/10.42124fbe.js"><link rel="prefetch" href="/assets/js/11.bdef2e64.js"><link rel="prefetch" href="/assets/js/12.9c5e83ed.js"><link rel="prefetch" href="/assets/js/13.3db43aaf.js"><link rel="prefetch" href="/assets/js/14.8f2ec86d.js"><link rel="prefetch" href="/assets/js/15.c6286125.js"><link rel="prefetch" href="/assets/js/16.5da2b31d.js"><link rel="prefetch" href="/assets/js/17.c9deef07.js"><link rel="prefetch" href="/assets/js/18.13ed30af.js"><link rel="prefetch" href="/assets/js/19.f1a01180.js"><link rel="prefetch" href="/assets/js/20.30f7288c.js"><link rel="prefetch" href="/assets/js/21.477730e4.js"><link rel="prefetch" href="/assets/js/22.ab119ff1.js"><link rel="prefetch" href="/assets/js/23.9bbc22fc.js"><link rel="prefetch" href="/assets/js/24.cb1899b8.js"><link rel="prefetch" href="/assets/js/25.64669f1d.js"><link rel="prefetch" href="/assets/js/26.f3040183.js"><link rel="prefetch" href="/assets/js/27.2938dd4c.js"><link rel="prefetch" href="/assets/js/28.cd87026d.js"><link rel="prefetch" href="/assets/js/29.b92287f4.js"><link rel="prefetch" href="/assets/js/3.103e70cb.js"><link rel="prefetch" href="/assets/js/30.af43d48f.js"><link rel="prefetch" href="/assets/js/31.8c7148f5.js"><link rel="prefetch" href="/assets/js/32.d42beb3f.js"><link rel="prefetch" href="/assets/js/33.223bba8e.js"><link rel="prefetch" href="/assets/js/34.04b12083.js"><link rel="prefetch" href="/assets/js/35.19c65fa0.js"><link rel="prefetch" href="/assets/js/36.a1a664b9.js"><link rel="prefetch" href="/assets/js/37.d2e7a2dd.js"><link rel="prefetch" href="/assets/js/38.4f737159.js"><link rel="prefetch" href="/assets/js/40.40a9daf9.js"><link rel="prefetch" href="/assets/js/5.2f32d917.js"><link rel="prefetch" href="/assets/js/6.d92ecc16.js"><link rel="prefetch" href="/assets/js/7.a09f8ef2.js"><link rel="prefetch" href="/assets/js/8.5b00daa2.js"><link rel="prefetch" href="/assets/js/9.9d06f44a.js">
    <link rel="stylesheet" href="/assets/css/0.styles.6a4803ab.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/" class="home-link router-link-active"><!----> <span class="site-name">前端面试知识总结</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/" class="nav-link">
  首页
</a></div><div class="nav-item"><a href="/guide/" class="nav-link">
  指南
</a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="项目" class="dropdown-title"><span class="title">项目</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/project/shop/" class="nav-link router-link-active">
  大型电商
</a></li><li class="dropdown-item"><!----> <a href="/project/music/" class="nav-link">
  vue实现音乐app
</a></li></ul></div></div> <!----></nav></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><nav class="nav-links"><div class="nav-item"><a href="/" class="nav-link">
  首页
</a></div><div class="nav-item"><a href="/guide/" class="nav-link">
  指南
</a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="项目" class="dropdown-title"><span class="title">项目</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/project/shop/" class="nav-link router-link-active">
  大型电商
</a></li><li class="dropdown-item"><!----> <a href="/project/music/" class="nav-link">
  vue实现音乐app
</a></li></ul></div></div> <!----></nav>  <ul class="sidebar-links"><li><section class="sidebar-group depth-0"><p class="sidebar-heading"><span>介绍</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/project/shop/" class="sidebar-link">简介</a></li></ul></section></li><li><section class="sidebar-group depth-0"><p class="sidebar-heading open"><span>SPU、SKU</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/project/shop/md/sku.html" class="active sidebar-link">SPU、SKU</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/project/shop/md/sku.html#认识spu、sku" class="sidebar-link">认识SPU、SKU</a></li><li class="sidebar-sub-header"><a href="/project/shop/md/sku.html#基本逻辑" class="sidebar-link">基本逻辑</a></li><li class="sidebar-sub-header"><a href="/project/shop/md/sku.html#改变数据结构" class="sidebar-link">改变数据结构</a></li><li class="sidebar-sub-header"><a href="/project/shop/md/sku.html#sku状态处理" class="sidebar-link">SKU状态处理</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/project/shop/md/sku.html#计算已存在的路径" class="sidebar-link">计算已存在的路径</a></li><li class="sidebar-sub-header"><a href="/project/shop/md/sku.html#计算待确认的路径" class="sidebar-link">计算待确认的路径</a></li></ul></li></ul></li></ul></section></li><li><section class="sidebar-group depth-0"><p class="sidebar-heading"><span>封装请求</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/project/shop/md/request.html" class="sidebar-link">/project/shop/md/request.html</a></li></ul></section></li><li><section class="sidebar-group depth-0"><p class="sidebar-heading"><span>购物车</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/project/shop/md/cart.html" class="sidebar-link">/project/shop/md/cart.html</a></li></ul></section></li><li><section class="sidebar-group depth-0"><p class="sidebar-heading"><span>优惠券</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/project/shop/md/coupon.html" class="sidebar-link">/project/shop/md/coupon.html</a></li></ul></section></li><li><section class="sidebar-group depth-0"><p class="sidebar-heading"><span>订单</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/project/shop/md/order.html" class="sidebar-link">/project/shop/md/order.html</a></li></ul></section></li><li><section class="sidebar-group depth-0"><p class="sidebar-heading"><span>其他技巧</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/project/shop/md/skill.html" class="sidebar-link">/project/shop/md/skill.html</a></li></ul></section></li></ul> </aside> <main class="page"> <div class="theme-default-content content__default"><h1 id="spu、sku"><a href="#spu、sku" class="header-anchor">#</a> SPU、SKU</h1> <h2 id="认识spu、sku"><a href="#认识spu、sku" class="header-anchor">#</a> 认识SPU、SKU</h2> <p>一个标准的电商都需要用到<code>spu</code>,<code>sku</code>来妥善管理好商品.</p> <div class="custom-block tip"><p class="custom-block-title">TIP</p> <p><strong>SPU</strong>(Standard Product Unit) 标准化产品 -商品</p> <p><strong>SKU</strong>(Stock Keeping Unit) 库存量单位 -商品的规格，单品</p></div> <p>这里的SPU-这件商品的信息，SKU-下方可选择配置颜色等</p> <ul><li><p>每个<code>sku</code>由各种规格组成，而几个规格值属于一类规格名。</p></li> <li><p><code>spu</code>包含一组<code>sku</code>,然后单个<code>sku</code>包含一组规格数组，规格数组里面的对象由规格名和规格值组成。</p></li></ul> <p><img src="https://image.yangxiansheng.top/img/20200521161734.png?imagelist" alt=""></p> <p><img src="https://image.yangxiansheng.top/img/20200521161807.png?imagelist" alt=""></p> <div class="language-markdown extra-class"><pre class="language-markdown"><code>规格:
颜色: 暗夜绿 黑色
运存: 64GB 256GB 
版本 : 全网通 电信

规格名：颜色
规格值 : 暗夜绿 黑色
</code></pre></div><blockquote><p>sku状态判断就像是字典里面查字典，如果查不到组合就是不可选状态，如果有就是可选状态.将skuList抽离成一个矩阵 然后进行旋转</p></blockquote> <div class="language- extra-class"><pre class="language-text"><code>金属灰 七龙珠 小号s
青芒色 灌篮高手 中号M
青芒色 圣斗士 大号L
橘黄色 七龙珠 大号L
</code></pre></div><h2 id="基本逻辑"><a href="#基本逻辑" class="header-anchor">#</a> 基本逻辑</h2> <p>可以看到我们<a href="https://dongtai.yangxiansheng.top/v1/spu/id/2/detail" target="_blank" rel="noopener noreferrer">spu详情<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>返回的数据结构是</p> <div class="language- extra-class"><pre class="language-text"><code>-- spu
   -- detail
   -- sku_list
      -- sku
         -- detail
         -- specs
            -- spec
            -- spec
            -- spec
   -- code
   
</code></pre></div><br>
将里面的拿到的规格数组组成二维数组是这样的
<div class="language- extra-class"><pre class="language-text"><code>金属灰 七龙珠 小号s
青芒色 灌篮高手 中号M
青芒色 圣斗士 大号L
橘黄色 七龙珠 大号L
</code></pre></div><p>可以发现，将矩阵转置后就可以得到正常显示的规格数组,所以我们要做的事情基本可以确定</p> <p><img src="https://raw.githubusercontent.com/imageList/imglist/master/20200624170117.png" alt="20200624170117.png"></p> <h2 id="改变数据结构"><a href="#改变数据结构" class="header-anchor">#</a> 改变数据结构</h2> <p>我们拿到的<code>SKU</code>数据是一个数组,里面包含了对应每项的规格数组,首先需要将它置为一个二维数组，然后将二维数组进行转置,生成想要的数据。</p> <p>这里我们使用面向对象形式进行处理数据。</p> <div class="custom-block warning"><p class="custom-block-title">WARNING</p> <ul><li>Fence-group <strong>sku</strong>面板对象</li> <li>Fence <strong>栅栏</strong>对象</li> <li>Cell  <strong>规格元素</strong></li></ul> <p>转置生成的二维数组之后,将每个规格名相同的规格数组保存到对应的<strong>Fence</strong>下,在这之前可以进行可视规格的相关处理之后,再初始化<strong>Fence</strong>对象</p></div> <br> <p><strong>初始定义好的模型</strong>:</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">class</span> <span class="token class-name">FenceGroup</span> <span class="token punctuation">{</span>
  <span class="token comment">// 抽离出一个矩阵</span>
  spu
  skuList <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>
  fences <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>
  <span class="token function">constructor</span><span class="token punctuation">(</span><span class="token parameter">spu</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>spu <span class="token operator">=</span> spu
    <span class="token keyword">this</span><span class="token punctuation">.</span>skuList <span class="token operator">=</span> spu<span class="token punctuation">.</span>sku_list
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token operator">...</span>

<span class="token keyword">class</span> <span class="token class-name">Fence</span> <span class="token punctuation">{</span>
  Cells <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>
  specs
  title
  title_id
  <span class="token function">constructor</span><span class="token punctuation">(</span><span class="token parameter">specs</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>specs <span class="token operator">=</span> specs
    <span class="token keyword">this</span><span class="token punctuation">.</span>title <span class="token operator">=</span> specs<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">.</span>key
    <span class="token keyword">this</span><span class="token punctuation">.</span>title_id <span class="token operator">=</span> specs<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">.</span>key_id
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token operator">...</span>

<span class="token keyword">class</span> <span class="token class-name">Cell</span><span class="token punctuation">{</span>
  title
  id
  status <span class="token operator">=</span> CellStatus<span class="token punctuation">.</span><span class="token constant">WAITING</span>
  spec
  <span class="token function">constructor</span><span class="token punctuation">(</span><span class="token parameter">spec</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">// 设置属性</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>title <span class="token operator">=</span> spec<span class="token punctuation">.</span>value
    <span class="token keyword">this</span><span class="token punctuation">.</span>id <span class="token operator">=</span> spec<span class="token punctuation">.</span>value_id
    <span class="token keyword">this</span><span class="token punctuation">.</span>spec <span class="token operator">=</span> spec
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><br> <p>首先获取初始状态的二维数组,这里需要定义一个<a href="https://github.com/251205668/Magic_Shop/blob/master/magic_shop/components/models/matrix.js" target="_blank" rel="noopener noreferrer">矩阵<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>抽分业务,矩阵类需要提供转置遍历等接口。</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token function">_createMatrix</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
  <span class="token keyword">const</span> m <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>
  <span class="token keyword">this</span><span class="token punctuation">.</span>sku_list<span class="token punctuation">.</span><span class="token function">forEach</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">sku</span><span class="token punctuation">)</span><span class="token operator">=&gt;</span><span class="token punctuation">{</span>
    m<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span>sku<span class="token punctuation">.</span>specs<span class="token punctuation">)</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span>
  <span class="token comment">// matrix 矩阵类</span>
  <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">Matrix</span><span class="token punctuation">(</span>m<span class="token punctuation">)</span>
<span class="token punctuation">}</span>
</code></pre></div><p>然后需要将矩阵转置,转置之后将每个一维数组都抛给<a href="https://github.com/251205668/Magic_Shop/blob/master/magic_shop/components/models/fence.js" target="_blank" rel="noopener noreferrer">Fence<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></p> <p><strong>矩阵转置:</strong></p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token function">transpose</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
  <span class="token keyword">let</span> desArray <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>
  <span class="token keyword">for</span><span class="token punctuation">(</span><span class="token keyword">let</span> j <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>j <span class="token operator">&lt;</span> <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">col</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> j<span class="token operator">++</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
    desArray<span class="token punctuation">[</span>j<span class="token punctuation">]</span> <span class="token operator">=</span><span class="token punctuation">[</span><span class="token punctuation">]</span>
    <span class="token keyword">for</span><span class="token punctuation">(</span><span class="token keyword">let</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>i<span class="token operator">&lt;</span><span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">row</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>i<span class="token operator">++</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
        desArray<span class="token punctuation">[</span>j<span class="token punctuation">]</span><span class="token punctuation">[</span>i<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>m<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">[</span>j<span class="token punctuation">]</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
  <span class="token keyword">return</span> desArray
<span class="token punctuation">}</span>
</code></pre></div><br> <p><strong>初始化规格矩阵</strong></p> <p>首先需要定义<code>Fence</code>处理规格矩阵方法</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token function">init</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
  <span class="token keyword">this</span><span class="token punctuation">.</span>specs<span class="token punctuation">.</span><span class="token function">forEach</span><span class="token punctuation">(</span><span class="token parameter">spec</span><span class="token operator">=&gt;</span><span class="token punctuation">{</span>
    <span class="token comment">// 去重</span>
    <span class="token keyword">const</span> existed <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>cells<span class="token punctuation">.</span><span class="token function">some</span><span class="token punctuation">(</span><span class="token parameter">cell</span><span class="token operator">=&gt;</span>cell<span class="token punctuation">.</span>id <span class="token operator">===</span> spec<span class="token punctuation">.</span>value_id<span class="token punctuation">)</span>
    <span class="token keyword">if</span><span class="token punctuation">(</span>existed<span class="token punctuation">)</span><span class="token punctuation">{</span>
      <span class="token keyword">return</span>
    <span class="token punctuation">}</span>
    <span class="token comment">// 初始化元素</span>
    <span class="token keyword">const</span> cell <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Cell</span><span class="token punctuation">(</span>spec<span class="token punctuation">)</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>cells<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span>cell<span class="token punctuation">)</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>

</code></pre></div><p><code>Fence-Goup</code></p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token function">initFecnce</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
   <span class="token keyword">const</span> matrix <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">_createMatrix</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>skuList<span class="token punctuation">)</span>
   <span class="token keyword">const</span> fences <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>
   <span class="token keyword">const</span> <span class="token constant">AT</span> <span class="token operator">=</span> matrix<span class="token punctuation">.</span><span class="token function">transpose</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>skuList<span class="token punctuation">)</span>
   <span class="token comment">// 这里每个二维数组的规格名已经统一</span>
   <span class="token constant">AT</span><span class="token punctuation">.</span><span class="token function">forEach</span><span class="token punctuation">(</span><span class="token parameter">specs</span><span class="token operator">=&gt;</span><span class="token punctuation">{</span>
     <span class="token keyword">const</span> fence <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Fence</span><span class="token punctuation">(</span>specs<span class="token punctuation">)</span>
     fence<span class="token punctuation">.</span><span class="token function">init</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
     <span class="token comment">// 暂时判断可视规格</span>
     fences<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span>fence<span class="token punctuation">)</span>
     <span class="token keyword">this</span><span class="token punctuation">.</span>fences <span class="token operator">=</span> fences
   <span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>
</code></pre></div><h2 id="sku状态处理"><a href="#sku状态处理" class="header-anchor">#</a> SKU状态处理</h2> <p>在拿到正确的规格矩阵后,并且可以通过面向对象的方式取到<strong>面板数据</strong></p> <p><img src="https://image.yangxiansheng.top/img/1586610274779.png?imagelist" alt=""></p> <br> <p>接下来我们需要做的事情是:当用户点击一个<code>cell</code>规格时需要引起其他元素的状态改变,并且高亮选中的路径。确定禁用状态就是<code>sku</code>算法的<strong>核心</strong>,状态可分为<strong>选中</strong>,<strong>未选</strong>,<strong>禁用</strong>。</p> <p>首先规格都是可选的,当用户点击一个规格值时,确认<code>青芒色</code>和<code>七龙珠</code>是否在一个<code>sku</code>路径中存在,如果这条路径找不到,就显示为禁用状态,然后如果存在改变状态为可选后,再确认<code>青芒色+七龙珠</code>和尺码选项是否存在,确定禁用状态。</p> <div class="custom-block danger"><p class="custom-block-title">WARNING</p> <p>这样做思想通常是错误的,因为太线性思考了这个问题,可能存在反向选择，<strong>我们需要在点击青芒色之后算图案尺码六个路径存在性，不存在则禁用，然后点击灌篮高手时再重新计算<code>青芒色+灌篮高手+尺码</code>三个路径是否存在,不存在禁用</strong>。</p></div> <div class="custom-block tip"><p class="custom-block-title">规律</p> <p>总结出来的规律就是: 已选规格的改变，我们都需要计算所有的规格路径,确定好已存在的路径,通过将待确认的路径和其对比就可以确认<code>SKU</code>的禁用状态。</p> <p>所以接下来要做的事情有两件:</p> <ul><li>计算已存在的<strong>sku</strong>路径</li> <li>计算待确定的<strong>sku</strong>路径</li></ul></div> <h3 id="计算已存在的路径"><a href="#计算已存在的路径" class="header-anchor">#</a> 计算已存在的路径</h3> <p>在每个<code>SKU</code>的返回结果中都返回了一个<strong>code</strong>,比如<code>2$1-45#3-9#4-14</code>,他代表<code>SpuId</code>和<code>SPU</code>的这条路径规格字符串。所以这里需要将它进行一个排列组合,然后将所有的组合推到一个数组中才能拿到所有的<code>sku</code>路径</p> <p>这里我们定义一个<a href="https://github.com/251205668/Magic_Shop/blob/master/magic_shop/components/models/judger.js" target="_blank" rel="noopener noreferrer">judge类<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>处理业务,<a href="https://github.com/251205668/Magic_Shop/blob/master/magic_shop/components/models/sku-code.js" target="_blank" rel="noopener noreferrer">SkuCode<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>处理code,这里需要借助到传入数组的辅助类<a href="https://github.com/251205668/Magic_Shop/blob/4fc92d839dabc4fe1f4a4d3c24f8dd2a03a2cda5/magic_shop/utils/util.js" target="_blank" rel="noopener noreferrer">排列组合<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></p> <p><strong>处理Sku的code</strong></p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token function">split</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
  <span class="token keyword">const</span> SpuIdAndSpec <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>code<span class="token punctuation">.</span><span class="token function">split</span><span class="token punctuation">(</span><span class="token string">&quot;$&quot;</span><span class="token punctuation">)</span>
  <span class="token keyword">this</span><span class="token punctuation">.</span>SpuId <span class="token operator">=</span> SpuIdAndSpec<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span>
  <span class="token comment">// 规格数组 然后进行排列数组</span>
  <span class="token keyword">const</span> SpecArray <span class="token operator">=</span>  SPuIdAndSpec<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token function">split</span><span class="token punctuation">(</span><span class="token string">&quot;#&quot;</span><span class="token punctuation">)</span>
  <span class="token keyword">for</span><span class="token punctuation">(</span><span class="token keyword">let</span> i <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span>i<span class="token operator">&lt;</span>SpecArray<span class="token punctuation">.</span>length<span class="token punctuation">;</span>i<span class="token operator">++</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
    <span class="token comment">// 相当于一个球出现几次的情况</span>
    <span class="token keyword">const</span> result <span class="token operator">=</span> <span class="token function">combine</span><span class="token punctuation">(</span>SpecArray<span class="token punctuation">,</span>i<span class="token punctuation">)</span>
    <span class="token comment">// 转为一维数组</span>
   <span class="token keyword">let</span> jointResult <span class="token operator">=</span> result<span class="token punctuation">.</span><span class="token function">map</span><span class="token punctuation">(</span><span class="token parameter">r</span><span class="token operator">=&gt;</span>r<span class="token punctuation">.</span><span class="token function">join</span><span class="token punctuation">(</span><span class="token string">&quot;#&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span>
  <span class="token keyword">this</span><span class="token punctuation">.</span>sequment <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>sequment<span class="token punctuation">.</span><span class="token function">concat</span><span class="token punctuation">(</span>joinResult<span class="token punctuation">)</span>
<span class="token punctuation">}</span>
</code></pre></div><br> <p>然后我们需要将每个<code>sku</code>的排列组合写入一个数组,这样就计算完成了已存在的路径。</p> <div class="language-js extra-class"><pre class="language-js"><code> <span class="token comment">// 返回所有的字典的路径</span>
  <span class="token function">_initpathDirt</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>fenceGroup<span class="token punctuation">.</span>spu<span class="token punctuation">.</span>sku_list<span class="token punctuation">.</span><span class="token function">forEach</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">s</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
      <span class="token keyword">const</span> SkuCode <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Code</span><span class="token punctuation">(</span>s<span class="token punctuation">.</span>code<span class="token punctuation">)</span>
      <span class="token keyword">this</span><span class="token punctuation">.</span>pathDirt <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>pathDirt<span class="token punctuation">.</span><span class="token function">concat</span><span class="token punctuation">(</span>SkuCode<span class="token punctuation">.</span>seqments<span class="token punctuation">)</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span>
</code></pre></div><p>最终结果: <code>[&quot;1-45&quot;, &quot;3-9&quot;, &quot;4-14&quot;, &quot;1-45#3-9&quot;, &quot;1-45#4-14&quot;, &quot;3-9#4-14&quot;, &quot;1-45#3-9#4-14&quot;, &quot;1-42&quot;, &quot;3-10&quot;, &quot;4-15&quot;, &quot;1-42#3-10&quot;, &quot;1-42#4-15&quot;, &quot;3-10#4-15&quot;, &quot;1-42#3-10#4-15&quot;, &quot;1-42&quot;, &quot;3-11&quot;, &quot;4-16&quot;, &quot;1-42#3-11&quot;, &quot;1-42#4-16&quot;, &quot;3-11#4-16&quot;, &quot;1-42#3-11#4-16&quot;, &quot;1-44&quot;, &quot;3-9&quot;, &quot;4-14&quot;, &quot;1-44#3-9&quot;, &quot;1-44#4-14&quot;, &quot;3-9#4-14&quot;, &quot;1-44#3-9#4-14&quot;]</code></p> <h3 id="计算待确认的路径"><a href="#计算待确认的路径" class="header-anchor">#</a> 计算待确认的路径</h3> <p>这里算的上是确定<code>sku</code>禁用状态最难的地方了。需要改变元素状态,首先需要在<code>cell</code>中定义状态属性。这里定义为: <strong>selected</strong> <strong>forbidden</strong> <strong>waiting</strong></p> <p>首先需要在组件上传递<code>cell</code>的信息,这里需要进行跨组件传递事件,
这里的<code>x</code>,<code>y</code>也需要传递，方便对<code>cell</code>遍历，这俩各参数分别是横列数，通过遍历所得。</p> <div class="language-js extra-class"><pre class="language-js"><code> <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">triggerEvent</span><span class="token punctuation">(</span><span class="token string">'cellTap'</span><span class="token punctuation">,</span><span class="token punctuation">{</span>cell<span class="token operator">:</span><span class="token keyword">this</span><span class="token punctuation">.</span>properties<span class="token punctuation">.</span>Cell<span class="token punctuation">,</span>x<span class="token operator">:</span><span class="token keyword">this</span><span class="token punctuation">.</span>properties<span class="token punctuation">.</span>x<span class="token punctuation">,</span>y<span class="token operator">:</span><span class="token keyword">this</span><span class="token punctuation">.</span>properties<span class="token punctuation">.</span>y<span class="token punctuation">}</span><span class="token punctuation">,</span><span class="token punctuation">{</span>bubbles<span class="token operator">:</span><span class="token boolean">true</span><span class="token punctuation">,</span>composed<span class="token operator">:</span><span class="token boolean">true</span><span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre></div><p>// TODO: 待确定路径判断 选择联动 细节处理</p></div> <footer class="page-edit"><!----> <div class="last-updated"><span class="prefix">Last update:</span> <span class="time">7/1/2020, 9:33:20 PM</span></div></footer> <div class="page-nav"><p class="inner"><span class="prev">
      ←
      <a href="/project/shop/" class="prev router-link-active">
        简介
      </a></span> <span class="next"><a href="/project/shop/md/request.html">
        /project/shop/md/request.html
      </a>
      →
    </span></p></div> </main></div><div class="global-ui"><!----><!----></div></div>
    <script src="/assets/js/app.81dd3622.js" defer></script><script src="/assets/js/2.d1b1e148.js" defer></script><script src="/assets/js/39.fcdeadea.js" defer></script><script src="/assets/js/4.a3faee54.js" defer></script>
  </body>
</html>
