# 项目总结

## 书城小程序(mpvue)

**这个项目涉及的技术栈:** 

mpvue、原生小程序、 vue全家桶、epubjs、flyio

**项目的过程中是否有遇到过一些困难，最终是如何解决的:**

1. 解决小程序请求问题,利用`flyio`封装请求库

```js
function createFly (){
  if(mpvuePlatForm === 'wx'){
    const Fly = require('flyio/dist/npm/wx')
    return new Fly()
  }else{
    return null
  }
}
// 封装get请求
export function get(url,param = {}){
  const fly = createFly()
  if(fly){
    return new Promise((resolve,reject)=>{
      fly.get(url,params).then((response)=>{
        if(response && response.data){
          resolve(response)
        }else{
          const msg = '请求失败'
          mpvue.showToast({
            title:msg,
            duration:2000
          })
          reject(response)
        }
      }).catch(err=>{
        console.log(err)
      })
    })
  }
}
```
2. 解析书籍目录,解构递归解析

因为拿到的解析过后的目录是一个树状结构的数据结构数组,很难进行操作,所以需要将他转换一维数组
![20200710154046.png](https://raw.githubusercontent.com/imageList/imglist/master/20200710154046.png)

```js
function flatten(array){
  // 多级目录递归吧元素放到一个数组,最后打散放到一个大数组
  return [].concat(...array.map(item=>[].concat(item,...flatten(item.subitems))))
}
```

3. 解决小程序中无法使用`epubjs`解析库

先使用vue搭建阅读器项目,然后只需要传入书名跳转到每本书的阅读器界面,之后利用`web-view`将阅读器引入小程序，完成功能搭建。


**项目自己是否做过一些优化，包括代码、开发效率、性能、体验:**

`nginx`搭建资源服务器

**项目当中存在的一些问题，可能的解决思路:**

`mpvue`打包之后的项目较原生比较卡顿

解决思路: 按需加载`ui`库文件

**项目最终达成的成果:**

一套完整体系的书城小程序搭配音乐播放功能


**项目带给你的成长是什么:**

学习了使用`mpvue`类Vue语法形式开发微信小程序,并且熟悉了`Vuex`使用流程,巩固了ES6语法和吸取了构建大型项目的经验。提升了自己解决问题bug的方式。


## 学生综合管理系统

**这个项目涉及的技术栈:**

前端: Vue全家桶、`Vue-element-admin`、 `element-ui`、`echarts`、`websocket`

后端: Springboot、jpa、jackson、lombok

**项目的过程中是否有遇到过一些困难，最终是如何解决的:**

改造`Vue-element-admin`的登录和权限管理系统

搭建实时聊天系统


**项目自己是否做过一些优化，包括代码、开发效率、性能、体验:**

打包优化

**项目当中存在的一些问题，可能的解决思路:**

管理员权限下所有路由都能看见,但是有些路由并不需要


**项目最终达成的成果:**

[体验地址](http://student-admin.yangxiansheng.top/)

**项目带给你的成长是什么:**

- 学会如何开发中后台简单的接口
- 积累了开发中后台前端页面的经验
- 学习了`vue`中使用`echarts`
- 学习了使用`websocket`搭建实时聊天系统
- 学习了统一拦截请求的封装

## 电商小程序(原生)

**这个项目涉及的技术栈:**

原生小程序、lin-ui组件库


**项目的过程中是否有遇到过一些困难，最终是如何解决的:**

`sku`面板开发

通用购物车开发

无感知刷新处理

**项目自己是否做过一些优化，包括代码、开发效率、性能、体验:**

封装前端异常处理

**项目当中存在的一些问题，可能的解决思路:**

切换优惠券或者订单`tab`会有闪屏问题。

**项目最终达成的成果:**

搭建了一个从商品列表首页到购物车到专题到订单优惠券一系列的电商系统小程序。

**项目带给你的成长是什么:**

- 学习使用模块化思想完成业务逻辑
- 学习如何搭建复杂的`sku`面板全过程
- 学习搭建通用搜索模块和通用购物车模块
- 学习无感知刷新令牌封装和通用处理微信授权业务
- 巩固了微信小程序的组件的使用和`lin-ui`组件库的使用技巧
- 学习下单到结算到使用优惠券全过程



## 小程序校验token,封装无感知刷新令牌

1. 在小程序启动时,校验本地storage里面是否存在`token`,如果不存在就去服务端请求token
2. 请求token一般是通过调用wx.login获取一个临时code码,然后配合服务端生成openId,之后服务端通过验证颁发令牌
3. 无感知刷新,因为令牌是有期限的,当令牌过期之后很多需要鉴权的数据无法请求,会给用户造成不好的影响,所以应该在封装微信请求中加入刷新令牌选项,操作如下，每次请求后拿到HTTP的状态码,如果是401,则重新向服务端请求token,之后添加在请求头部,请求别的数据
4. 现在的pc端一般会有两个令牌，一个长令牌和一个短期限令牌。短期限令牌过期后不会立即向服务端请求新的令牌,一般是通过长令牌去继续请求数据

## JWT令牌和redis处理验证码
JWT 认证流程：

- 用户输入用户名/密码登录，服务端认证成功后，会返回给客户端一个 JWT
- 客户端将 token 保存到本地（通常使用 localstorage，也可以使用 cookie）
- 当用户希望访问一个受保护的路由或者资源的时候，需要请求头的 Authorization 字段中使用Bearer 模式添加 JWT，其内容看起来是下面这样

加入验证码登录判断

1. 服务端接收到前端生成的一个`sid`(当做redis的key),生成验证码
2. 前端需要传递给后端 账号 密码 key值 验证码 
3. 后端取出redis中key值为sid的value,然后和验证码进行比对，验证通过去数据库校验密码，密码可以用盐进行加密，验证比对即可
4. 两层验证通过,签发令牌携带用户id,登录成功


## 路由权限判断



## 谈谈书城项目

开发背景
难点: 1.兼容性 2.请求库封装 3.epubjs不支持w小程序 4.主题换肤 5.播放器,随机播放,下一首
心得体会

项目开发的初衷,因为感觉前端好像学了蛮久的了,自己却没做过什么实际的真实意义前后端的团队项目,然后大学里很多比赛自己也没什么拿的出手的项目参赛。然后心里就萌生了想法,然后就去看别人的项目,发现别人做的书城项目的布局都比较老土,然后看到了追书神器的`ui`,就感觉这个ui给人的感觉不错。然后就仿造着这个`ui`去写页面，当然中间使用了小程序的ui框架去快速搭建页面。然后由于一开始并未学习过小程序,只学习了vue框架的生态,然后当时又看到了`mpvue`这个框架也是利用vue语法跨端构建小程序。于是就开始配合视频和官方文档和百度开始写这个项目的前端。后端部分是让同学写的。第一次感觉到了团队开发的效率，棒棒哒。疫情期间，我们只用了两个月就完成了第一版代码。

### 碰到的难题,怎么解决的

- 首先第一个点就是碰到许多兼容性问题,mpvue虽然支持vue语法但是有些指令并不能在小程序中生效,比如v-show，至今都不支持，还有新的路由跳转方式和新的vuex在主入口引入方式等，这些大部分都是在百度或社群上解决然后记录笔记的

- 小程序请求不支持promise,依然是requst回调形式。引入flyio(类axios)的跨平台请求库，然后简单封装处理异常部分。

- 小程序不支持引入epub.js去解析书籍资源,这个思前想后没有办法，最后只能使用Vue去开发一个阅读器,在路由里面传入fileName,然后组件加载这本书的阅读器。最后通过web-view引入打包构建好的域名，只需要传入书本名称


1. 学习到了vuex模块化的处理数据,对微信小程序音频开发这一块增加了了解。然后对布局这方面有了深刻认识。

### 技术创新点

同学A: 看到这个项目之后感觉还少了点什么,一味的读书并不是很舒服,应该来点音乐。不如在小程序内部内置一个榜单播放器吧，省的来回切换APP。
我: 音乐播放器还不简单，做一个。

我以为的音乐播放器很简单,其实这与想象中的截然不同，要做的功能还蛮多的: 1.首先需要搞好播放源 2. 播放器(歌曲暂停播放上一首下一首,播放列表弹出层,请求数据进行处理,播放模式切换等)

这里我都是在学习视频的基础上进行进一步改造的

首先**第一步就是用vuex存放数据**,比如**歌曲暂停还是播放**,播放列表数组,当前歌曲,**当前播放模式**等。然后就是开始写业务，**首先在created钩子里面new一个后台音乐播放器实例**(getBackgroundAudioManager)。然后将页面骨架初步写完。**点击模式**时通过computed改变图标，然后调用不同的Action生成不同模式下的歌曲列表,比如随机播放,这个时候我就需要书写一个洗牌算法把里面的歌曲列表打乱，最后再提交修改。然后最重要的是**监听点击上一首下一首或者播放暂停的时候**先去调用微信的audio暂停播放这些API，然后要去实时修改vuex里面数据，**比如我点击下一首**,这个要做的事: 1.将歌曲当前时间置为0 2.将歌曲在播放列表里面的index+1,然后修改vuex的currentSong,最后是调用微信API封装的播放方法，监听到歌曲能够播放就讲isPlay设为true,调用播放钩子，然后设置一下显示的时间
### 至今未解决的问题

- 资源加载并解析速度过慢,要等好久一本电子书才能加载出来
- 音乐播放器不支持歌词滚动

## 谈谈电商项目



电商项目的前端是学习小程序项目的练手项目，中间借助了其他项目的一些思想和代码编写方式。里面主要解决了两个比较难的问题

1. sku面板的状态管理

主要讲一下实现的思路: **首先处理数据这一部分需要将规格数组转置**,然后再显示到前端 接下来就是就是**确定全部的sku路径和待选择路径**，根据待选者路径是否在全部的sku里面查的到，来确定禁用状态。这一部分我是通过面向对象去处理的,然后规律:`已选规格的改变，我们都需要计算所有的规格路径,确定好已存在的路径,通过将待确认的路径和其对比就可以确认SKU的禁用状态`。然后就是利用引入一个排列组合方法计算出所有的所有的路径，待选路径判断，然后待选路径计算就是利用已选规格的状态改变都要计算所有的规格路径的规律去写的，细节太多了很难讲清楚。

最后状态改变是通过**封装了一个judger类处理状态改变**,当前端点击面板上的元素就去调用judger去做状态判断,然后更新fences数组，然后元素上的状态编写的`wxs`根据状态更新样式


2. 购物车

购物车部分主要和之前实现的本地购物车不太一样，这次实现的是与服务端同步的购物车模块，基本上也是一个通用的思想提炼。


添加商品进入购物车: 逻辑: 1.判断购物车库存量。2.添加商品:(首先传入skuId,判断缓存数组中是否已经存在,就在原来基础上增加数量,不存在就把sku推入购物车数组) 3.重新计算一下购物车选中的商品价格和刷新一下缓存

同步服务端: 首先获取本地缓存购物车对象,获取到里面的skuId，然后去服务端请求数据,获取sku数组然后刷新缓存,重新计算已选的价格,最后返回对象

## 谈谈后台管理系统项目

中后台项目:使用到的

主要提升了对vue模块化的思想和熟练后台开发流程。
主要讲一下代码的理解吧，
登录权限管理这一块源码分析:

全局路由守卫:
访问路由时会从 Cookie 中获取 Token，判断 Token 是否存在：

- 如果 Token 存在，将根据用户角色生成动态路由，然后访问路由，生成对应的页面组件。这里有一个特例，即用户访问 `/login` 时会重定向至 `/` 路由；
- 如果 Token 不存在，则会判断路由是否在白名单中，如果在白名单中将直接访问，否则说明该路由需要登录才能访问，此时会将路由生成一个 redirect 参数传入 login 组件，实际访问的路由为：`/login?redirect=/xxx`。
